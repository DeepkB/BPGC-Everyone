!function(){"use strict";const e=(e,n=(e=>e))=>(e.sort(((e,t)=>n(e)-n(t))),e);function n(e,n){return[...(n||document).querySelectorAll(e)]}function t(e){"vibrate"in navigator&&navigator.vibrate(e)}var o=["name","id","gender","bday","pfp","phone","address","blood","cgpa","status","station","hostel","room"];const a={A1:"B.E. Chemical",A3:"B.E. EEE",A4:"B.E. Mechanical",A7:"B.E. CSE",A8:"B.E. EnI",AA:"B.E. ECE",B1:"M.Sc. Biology",B2:"M.Sc. Chemistry",B3:"M.Sc. Economics",B4:"M.Sc. Maths",B5:"M.Sc. Physics",P:"PHD",PHD:"PHD",H101:"M.E. Chemical",H103:"M.E. Computer Science",H112:"M.E. Software Systems",H123:"M.E. Microelectronics",H129:"M.E. biotechnology",H140:"M.E. Embedded Systems",H141:"M.E. Design Engineering",H106:"M.E. Mechanical",H151:"M.E. Sanitation Science, Technology and Management",H152:"M.Phil. In Liberal Studies","":""},r={};o.forEach((e=>{r[e]=[]}));const s={};async function i(...e){let n=e.map((async e=>await async function(e){let n=await fetch(`./everyone/${e}.json`);n=await n.json(),o.forEach(((e,t)=>{r[e].push(...n[t])}))}(e)));await Promise.all(n)}function c(e,n){if(o.includes(e))return r[e][n];if("bday-name"==e){const e=["January","February","March","April","May","June","July","August","September","October","November","December"];let t=parseInt(r.bday[n]),o=parseInt(t%100);t/=100;let a=parseInt(t%100);t/=100;let s=parseInt(t%100);return s+=s>50?1900:2e3,`${o} ${e[a-1]}, ${s}`}const t=r.id[n],s=t.substring(0,4);if("year"==e)return s;const i=t.substring(4,8),c=i.substring(0,2),l=i.substring(2,4);let d="",u="",p="";if(i.match(/H\d{3}/))p=i;else if("P"==i.charAt(0))p="PHD";else if("PS"!=l&&"TS"!=l||"A"!=c.charAt(0))if("PS"!=l&&"TS"!=l||"B"!=c.charAt(0))if("A"==c.charAt(0)&&"A"==l.charAt(0))d=c;else if("B"==c.charAt(0)&&"A"==l.charAt(0))u=c,d=l;else if("A"==c.charAt(0)&&"B"==l.charAt(0))u=l,d=c;else{if("B"!=c.charAt(0)||"B"!=l.charAt(0))throw new Error(`WTF is their branch: ${t}`);u=c}else u=c;else d=c;const f=e.endsWith("-name");switch(e.replace(/\-name/,"")){case"degree_be":return f?a[d]:d;case"degree_msc":return f?a[u]:u;case"degree_h":return f?a[p]:p}throw new Error(`Field not found: ${e}`)}const l=document.createElement("A");l.setAttribute("download","everyone.csv"),l.style.display="none";let d=[],u=[],p=[],f="relevant";const m=25;function g(e){const n=$(),t=u.length;void 0===e&&(e=t-n);const o=u.slice(n,n+e).map(b).join(""),a=document.createElement("div");a.innerHTML=o,document.querySelector(".results-container").append(...a.children),w(),_()}function h(){d=function(){const e=[],n=r.id.length;for(let t=0;t<n;++t){let n=!0;for(const[e,o]of Object.entries(s))if(0!=o.length&&!o.includes(c(e,t))){n=!1;break}n&&e.push(t)}return e}(),v()}function v(){console.time("resolveQuery");let e=document.querySelector("#search-bar").value.trim().replace(/\s+/g," ");if(e=e.toLowerCase(),p=new Array(d.length).fill(0),/^\d{1,3}$/.test(e))for(let n=0;n<p.length;++n){let t=d[n];p[n]=[E(e,c("room",t)),n]}else if(/\d{4,}/.test(e))for(let n=0;n<p.length;++n){let t=d[n];p[n]=[L(e,c("phone",t)),n]}else if(/\d/.test(e))for(let n=0;n<p.length;++n){let t=d[n];p[n]=[A(e,c("id",t)),n]}else for(let n=0;n<p.length;++n){let t=d[n];p[n]=[S(e,c("name",t)),n]}console.timeEnd("resolveQuery"),y()}function y(n){switch(console.time("sortResults"),n||f){case"relevant":((e,n=(e=>e))=>{e.sort(((e,t)=>{e=n(e),t=n(t);let o=0;for(let n=0;n<e.length;++n)if(o=e[n]-t[n],0!=o)return o;return 0}))})(p,(e=>[-e[0][0],-e[0][1],e[0][2]]));break;case"room":((e,n=(e=>e))=>{e.sort(((e,t)=>n(e).localeCompare(n(t))))})(p,(([e,n])=>c("hostel",d[n])+c("room",d[n])));break;case"youngest":e(p,(([e,n])=>-parseInt(c("year",d[n]))));break;case"oldest":e(p,(([e,n])=>parseInt(c("year",d[n]))));break;case"bday":e(p,(([e,n])=>parseInt(c("bday",d[n]))));break;case"cgpa":e(p,(([e,n])=>{const t=c("cgpa",d[n]);return""==t?0:-parseFloat(t)}))}console.timeEnd("sortResults"),function(e,n){let t=0;for(let o=0;o<e.length;++o)n(e[o])&&(e[t++]=e[o]);e.splice(t)}(p,(e=>e[0][0])),u=new Array(p.length).fill(0);for(let e=0;e<p.length;++e)u[e]=d[p[e][1]];!function(e){const n=e?$():m,t=u.slice(0,n).map(b).join("");document.querySelector(".results-container").innerHTML=t,w(),_()}(!!n)}function b(e){const n=n=>c(n,e),t=(e,t)=>n(e)?t:"";return`\n    <div class="student-component ${`${t("degree_be","be")} ${t("degree_msc","msc")} ${t("degree_h","h")}`.trim().split(" ").map((e=>`student--${e}`)).join(" ")}" everyone-index="${e}">\n        <div class="student__id">${n("id")}</div>\n        <div class="student__name">${n("name")}</div>\n        <div class="student__badges">\n            <div class="student__badge badge-year">${n("year")}</div>\n            ${t("degree_msc",`<div class="student__badge badge-degree_msc">${n("degree_msc")}</div>`)}\n            ${t("degree_be",`<div class="student__badge badge-degree_be">${n("degree_be")}</div>`)}\n            ${t("degree_h",`<div class="student__badge badge-degree_h">${n("degree_h")}</div>`)}\n            ${n("room")?`<div class="student__badge badge-hostel">${n("hostel")} ${n("room")}</div>`:""}\n        </div>\n    </div>\n    `.trim().replace(/\n\s*/g,"")}function w(){n(".student-component").forEach((e=>{e.onclick=o=>{if(t(25),e.classList.contains("expanded"))return void e.classList.remove("expanded");if(e.classList.add("expanded"),e.querySelector(".student-info-grid"))return;const a=parseInt(e.getAttribute("everyone-index"));e.innerHTML+=function(e){const n=n=>c(n,e),t=(e,t)=>n(e)?t:"";return`\n    <div class="student-info-grid">\n        <div class="info-tile-wrapper info--year">\n            <div class="info-tile">\n                <span>Year</span>\n                ${n("year")}\n            </div>\n        </div>\n        ${t("room",`\n        <div class="info-tile-wrapper info--room">\n            <div class="info-tile">\n                <span>Room</span>\n                ${n("hostel")} ${n("room")}\n            </div>\n        </div>\n        `)}\n        ${t("degree_msc",`\n        <div class="info-tile-wrapper info--msc">\n            <div class="info-tile">\n                <span>M.Sc. Degree</span>\n                ${n("degree_msc-name")}\n            </div>\n        </div>\n        `)}\n        ${t("degree_be",`\n        <div class="info-tile-wrapper info--be">\n            <div class="info-tile">\n                <span>B.E. Degree</span>\n                ${n("degree_be-name")}\n            </div>\n        </div>\n        `)}\n        ${t("degree_h",`\n        <div class="info-tile-wrapper info--h">\n            <div class="info-tile">\n                <span>Higher Degree</span>\n                ${n("degree_h-name")}\n            </div>\n        </div>\n        `)}\n        ${function(e){const n=n=>c(n,e),t=(e,t)=>n(e)?t:"";return`\n    ${t("pfp",`\n    <div class="info-tile-wrapper info--pfp">\n        <div class="info-tile">\n            <div class="student__pfp" data-pfp="${n("pfp")}">\n            </div>\n        </div>\n    </div>\n    `)}\n    ${t("bday",`\n    <div class="info-tile-wrapper info--bday">\n        <div class="info-tile">\n            <span>Bday</span>\n            ${n("bday-name")}\n        </div>\n    </div>\n    `)}\n    ${t("cgpa",`\n    <div class="info-tile-wrapper info--cgpa">\n        <div class="info-tile">\n            <span>CGPA</span>\n            ${n("cgpa")}\n        </div>\n    </div>\n    `)}\n    ${t("blood",`\n    <div class="info-tile-wrapper info--blood">\n        <div class="info-tile">\n            <span>Blood</span>\n            ${n("blood")}\n        </div>\n    </div>\n    `)}\n    ${t("gender",`\n    <div class="info-tile-wrapper info--gender">\n        <div class="info-tile">\n            <span>Gender</span>\n            ${n("gender")}\n        </div>\n    </div>\n    `)}\n    ${t("phone",`\n    <div class="info-tile-wrapper info--phone">\n        <div class="info-tile">\n            <span>Phone</span>\n            ${n("phone")}\n        </div>\n    </div>\n    `)}\n    ${t("address",`\n    <div class="info-tile-wrapper info--address">\n        <div class="info-tile">\n            <span>Address</span>\n            ${n("address")}\n        </div>\n    </div>\n    `)}\n    `.trim().replace(/\n\s*/g,"")}(e)}\n    </div>\n    `.trim().replace(/\n\s*/g,"")}(a),n(".student__pfp").forEach((e=>{e.onclick=n=>{n.stopImmediatePropagation(),e.style.backgroundImage=`url('${e.getAttribute("data-pfp")}')`}}))}}))}function $(){return document.querySelector(".results-container").children.length}function _(){const e=$(),n=u.length,t=n-e;t>m?(document.querySelector(".view-more-section").classList.add("show-view-more"),document.querySelector(".view-more-button__count").innerText="[+25]"):document.querySelector(".view-more-section").classList.remove("show-view-more"),0!=t&&(t<=m||n<300)?(document.querySelector(".view-more-section").classList.add("show-view-all"),document.querySelector(".view-all-button__count").innerText=`[+${t}]`):document.querySelector(".view-more-section").classList.remove("show-view-all")}function S(e,n){if(0==e.length)return[1,0,0];n=n.toLowerCase();let t=0,o=[0,0],a=[0,0];for(let r=0;r<n.length;++r)if(n.charAt(r)==e.charAt(t)){a=[1,r];let s=r-1;for(;s>=0&&n.charAt(s)==e.charAt(t-(r-s));)++a[0],a[1]=s,--s;if(++t,(o[0]<a[0]||o[0]==a[0]&&o[1]>a[1])&&(o=a),t==e.length)break}return t==e.length?[t,...o]:[0,0,0]}function A(e,n){return text.includes(e)?[e.length,e.length,text.indexOf(e)]:[0,0,0]}function E(e,n){return text==e?[3,3,0]:[0,0,0]}function L(e,n){return n.includes(e)?[1,0,0]:[0,0,0]}!async function(){(async function(){"serviceWorker"in navigator&&"ready"in navigator.serviceWorker&&await navigator.serviceWorker.ready;const e=(await window.caches.keys())[0],t=await window.caches.open(e);let o=(await t.keys()).filter((e=>e.url.includes("/everyone/"))).map((e=>e.url.match(/\d+(?=\.json)/)[0]));const a={2015:29.61,2016:27.4,2017:11.6,2018:14.3,2019:15.2,2020:15.2,2021:13.7};0==o.length&&(o=["2019","2020","2021"]);const r=i(...o);if(o.length!=Object.keys(a).length){const e=Object.keys(a).filter((e=>!o.includes(e))),t=e.reduce(((e,n)=>e+a[n]),0);n(".filter-toggle[field='year']").forEach((n=>{e.includes(n.getAttribute("value"))&&n.remove()})),document.querySelector(".filter-component[value='year']").insertAdjacentHTML("afterend",`\n        <div id="data-download-popup" class="popup-component">\n            <div class="popup__text">\n                <header>More Data <span>(${t.toFixed(2)}Kb)</span></header>\n                Click to download data for ${e.map((e=>`<b>${e}</b>`)).join(", ")}\n            </div>\n            <div id="data-download-cta" class="popup__cta data-download-ready">\n                <button id="data-download-button" class="popup__button single-image-button">\n                    ${document.querySelector("#template-icon-download-svg").innerHTML}\n                </button>\n                <button id="data-loading-button" class="popup__button single-image-button">\n                    ${document.querySelector("#template-icon-loading-svg").innerHTML}\n                </button>\n                <button id="data-loaded-button" class="popup__button single-image-button">\n                    ${document.querySelector("#template-icon-loaded-svg").innerHTML}\n                </button>\n            </div>\n        </div>\n        `),function(e){document.querySelector("#data-download-button").onclick=async function(n){const t=e.map((e=>fetch(`./everyone/${e}.json`).then((e=>e.json()))));this.parentElement.classList.add("data-loading"),document.querySelector("#data-download-popup .popup__text").innerHTML="\n        <header>Downloading...</header>\n        This may take a while depending on your internet connection\n        ",await Promise.all(t),this.parentElement.classList.add("data-loaded"),document.querySelector("#data-download-popup .popup__text").innerHTML="\n        <header>Data Downloaded</header>\n        Click here to refresh the app and view the downloaded years\n        ",document.querySelector("#data-loaded-button").onclick=e=>{location.reload()}}}(e)}await r,document.querySelector(".page").style.display="flex",document.querySelector(".preloader").classList.add("loaded"),h()})(),async function(){await navigator.serviceWorker.ready,await fetch("./static/fonts/Inconsolata.woff2");let e="<style>";for(const n of[100,200,300,400,500,600,700,800,900])e+=`\n        @font-face {\n            font-family: 'Inconsolata';\n            font-style: normal;\n            font-display: swap;\n            font-weight: ${n};\n            src: url(./static/fonts/Inconsolata.woff2) format('woff2');\n        }\n        `.trim().replace(/\n\s*/g,"");e+="</style>",document.head.innerHTML+=e,document.documentElement.classList.add("font-loaded")}(),n("svg").forEach((e=>{e.setAttribute("version","1.1")})),function(){const e=navigator.userAgent;let n="";e.match(/samsungbrowser/i)?n="Tap on the download icon near the URL bar":e.match(/chrome|chromium|crios/i)||e.match(/firefox|fxios/i)?n="Go to options and press Install":e.match(/safari/i)?n="Press the share icon and 'Add to Home Screen'":e.match(/opr\//i)?n="IDK figure it out, who tf uses Opera":e.match(/edg/i)&&(n="Go to options and press Install");document.querySelector("#pwa-install-guide").innerText=n}(),document.querySelector("#close-settings-tab").onclick=e=>{t(100),document.querySelector(".settings-tab").classList.add("hidden")},document.querySelector("#open-settings-tab").onclick=e=>{t(100),document.querySelector(".settings-tab").classList.remove("hidden")},n(".filter-toggle").forEach((e=>{e.onclick=n=>{t(50),async function(e,n){if(!(e in s))return void(s[e]=[n]);const t=s[e].indexOf(n);-1==t?s[e].push(n):s[e].splice(t,1)}(e.getAttribute("field"),e.getAttribute("value")),e.classList.toggle("selected"),h()}})),n(".select-all-toggles").forEach((e=>{e.onclick=o=>{t(50);const a=e.getAttribute("value"),r=n(`[value="${a}"] .filter-toggle`);!async function(e,...n){e in s?0==s[e].length?s[e]=n:s[e]=[]:s[e]=n}(a,...r.map((e=>e.getAttribute("value")))),r.some((e=>e.classList.contains("selected")))?r.forEach((e=>e.classList.remove("selected"))):r.forEach((e=>e.classList.add("selected"))),h()}})),function(){document.querySelector(".view-more-button").onclick=e=>g(m);document.querySelector(".view-all-button").onclick=e=>g()}(),n(".sort-button").forEach((e=>{e.onclick=n=>{var o;e.classList.contains("selected")||(t(50),e.parentElement.querySelector(".selected").classList.remove("selected"),e.classList.add("selected"),o=e.getAttribute("value"),f=o,y(f))}})),document.querySelector("#search-bar-clear-icon").onclick=n=>{document.querySelector("input#search-bar").value="",document.querySelector(".search-or-clear-rel").classList.toggle("show-clear-button",0!=e.value.length),document.querySelector("input#search-bar").focus(),v()};let e=document.querySelector("input#search-bar");e.addEventListener("keyup",(()=>{document.querySelector(".search-or-clear-rel").classList.toggle("show-clear-button",0!=e.value.length),v()}),{passive:!0})}()}();
