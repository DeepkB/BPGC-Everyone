!function(){"use strict";const e=(e,t=(e=>e))=>(e.sort(((e,n)=>t(e)-t(n))),e);function t(e,t){return[...(t||document).querySelectorAll(e)]}function n(e){"vibrate"in navigator&&navigator.vibrate(e)}var o=["name","id","hostel","room"];const r={A1:"B.E. Chemical",A3:"B.E. EEE",A4:"B.E. Mechanical",A7:"B.E. CSE",A8:"B.E. EnI",AA:"B.E. ECE",B1:"M.Sc. Biology",B2:"M.Sc. Chemistry",B3:"M.Sc. Economics",B4:"M.Sc. Maths",B5:"M.Sc. Physics",P:"PHD",PHD:"PHD",H101:"M.E. Chemical",H103:"M.E. Computer Science",H112:"M.E. Software Systems",H123:"M.E. Microelectronics",H129:"M.E. biotechnology",H140:"M.E. Embedded Systems",H141:"M.E. Design Engineering",H106:"M.E. Mechanical",H151:"M.E. Sanitation Science, Technology and Management",H152:"M.Phil. In Liberal Studies","":""},a={};o.forEach((e=>{a[e]=[]}));const s={};async function c(...e){let t=e.map((async e=>await async function(e){let t=await fetch(`./everyone/${e}.json`);t=await t.json(),o.forEach(((e,n)=>{a[e].push(...t[n])}))}(e)));await Promise.all(t)}function i(e,t){if(o.includes(e))return a[e][t];const n=a.id[t],s=n.substring(0,4);if("year"==e)return s;const c=n.substring(4,8),i=c.substring(0,2),l=c.substring(2,4);let d="",u="",m="";if(c.match(/H\d{3}/))m=c;else if("P"==c.charAt(0))m="PHD";else if("PS"!=l&&"TS"!=l||"A"!=i.charAt(0))if("PS"!=l&&"TS"!=l||"B"!=i.charAt(0))if("A"==i.charAt(0)&&"A"==l.charAt(0))d=i;else if("B"==i.charAt(0)&&"A"==l.charAt(0))u=i,d=l;else if("A"==i.charAt(0)&&"B"==l.charAt(0))u=l,d=i;else{if("B"!=i.charAt(0)||"B"!=l.charAt(0))throw new Error(`WTF is their branch: ${n}`);u=i}else u=i;else d=i;const f=e.endsWith("-name");switch(e.replace(/\-name/,"")){case"degree_be":return f?r[d]:d;case"degree_msc":return f?r[u]:u;case"degree_h":return f?r[m]:m}throw new Error(`Field not found: ${e}`)}const l=document.createElement("A");l.setAttribute("download","everyone.csv"),l.style.display="none";let d=[],u=[],m=[],f="relevant";const h=25;function g(e){const t=_(),n=u.length;void 0===e&&(e=n-t);const o=u.slice(t,t+e).map(b).join(""),r=document.createElement("div");r.innerHTML=o,document.querySelector(".results-container").append(...r.children),w(),S()}function p(){d=function(){const e=[],t=a.id.length;for(let n=0;n<t;++n){let t=!0;for(const[e,o]of Object.entries(s))if(0!=o.length&&!o.includes(i(e,n))){t=!1;break}t&&e.push(n)}return e}(),v()}function v(){console.time("resolveQuery");let e=document.querySelector("#search-bar").value.trim().replace(/\s+/g," ");if(e=e.toLowerCase(),m=new Array(d.length).fill(0),/^\d{1,3}$/.test(e))for(let t=0;t<m.length;++t){let n=d[t];m[t]=[$(e,i("room",n)),t]}else if(/\d/.test(e))for(let t=0;t<m.length;++t){let n=d[t];m[t]=[A(e,i("id",n)),t]}else for(let t=0;t<m.length;++t){let n=d[t];m[t]=[E(e,i("name",n)),t]}console.timeEnd("resolveQuery"),y()}function y(t){switch(console.time("sortResults"),t||f){case"relevant":((e,t=(e=>e))=>{e.sort(((e,n)=>{e=t(e),n=t(n);let o=0;for(let t=0;t<e.length;++t)if(o=e[t]-n[t],0!=o)return o;return 0}))})(m,(e=>[-e[0][0],-e[0][1],e[0][2]]));break;case"room":((e,t=(e=>e))=>{e.sort(((e,n)=>t(e).localeCompare(t(n))))})(m,(([e,t])=>i("hostel",d[t])+i("room",d[t])));break;case"youngest":e(m,(([e,t])=>-parseInt(i("year",d[t]))));break;case"oldest":e(m,(([e,t])=>parseInt(i("year",d[t]))));break;case"bday":e(m,(([e,t])=>parseInt(i("bday",d[t]))));break;case"cgpa":e(m,(([e,t])=>{const n=i("cgpa",d[t]);return""==n?0:-parseFloat(n)}))}console.timeEnd("sortResults"),function(e,t){let n=0;for(let o=0;o<e.length;++o)t(e[o])&&(e[n++]=e[o]);e.splice(n)}(m,(e=>e[0][0])),u=new Array(m.length).fill(0);for(let e=0;e<m.length;++e)u[e]=d[m[e][1]];!function(e){document.querySelector("#result-count").innerText=`${function(e){if(0==e)return e;let t="",n=0;for(;0!=e;)t=0!=n&&n%3==0?e%10+","+t:e%10+t,e=Math.floor(e/10),++n;return t}(u.length)}`;const t=e?_():h,n=u.slice(0,t).map(b).join("");document.querySelector(".results-container").innerHTML=n,w(),S()}(!!t)}function b(e){const t=t=>i(t,e),n=(e,n)=>t(e)?n:"";return`\n    <div class="student-component ${`${n("degree_be","be")} ${n("degree_msc","msc")} ${n("degree_h","h")}`.trim().split(" ").map((e=>`student--${e}`)).join(" ")}" everyone-index="${e}">\n        <div class="student__id">${t("id")}</div>\n        <div class="student__name">${t("name")}</div>\n        <div class="student__badges">\n            <div class="student__badge badge-year">${t("year")}</div>\n            ${n("degree_msc",`<div class="student__badge badge-degree_msc">${t("degree_msc")}</div>`)}\n            ${n("degree_be",`<div class="student__badge badge-degree_be">${t("degree_be")}</div>`)}\n            ${n("degree_h",`<div class="student__badge badge-degree_h">${t("degree_h")}</div>`)}\n            ${t("room")?`<div class="student__badge badge-hostel">${t("hostel")} ${t("room")}</div>`:""}\n        </div>\n    </div>\n    `.trim().replace(/\n\s*/g,"")}function w(){t(".student-component").forEach((e=>{e.onclick=o=>{if(n(25),e.classList.contains("expanded"))return void e.classList.remove("expanded");if(e.classList.add("expanded"),e.querySelector(".student-info-grid"))return;const r=parseInt(e.getAttribute("everyone-index"));e.innerHTML+=function(e){const t=t=>i(t,e),n=(e,n)=>t(e)?n:"";return`\n    <div class="student-info-grid">\n        <div class="info-tile-wrapper info--year">\n            <div class="info-tile">\n                <span>Year</span>\n                ${t("year")}\n            </div>\n        </div>\n        ${n("room",`\n        <div class="info-tile-wrapper info--room">\n            <div class="info-tile">\n                <span>Room</span>\n                ${t("hostel")} ${t("room")}\n            </div>\n        </div>\n        `)}\n        ${n("degree_msc",`\n        <div class="info-tile-wrapper info--msc">\n            <div class="info-tile">\n                <span>M.Sc. Degree</span>\n                ${t("degree_msc-name")}\n            </div>\n        </div>\n        `)}\n        ${n("degree_be",`\n        <div class="info-tile-wrapper info--be">\n            <div class="info-tile">\n                <span>B.E. Degree</span>\n                ${t("degree_be-name")}\n            </div>\n        </div>\n        `)}\n        ${n("degree_h",`\n        <div class="info-tile-wrapper info--h">\n            <div class="info-tile">\n                <span>Higher Degree</span>\n                ${t("degree_h-name")}\n            </div>\n        </div>\n        `)}\n        \n    </div>\n    `.trim().replace(/\n\s*/g,"")}(r),t(".student__pfp").forEach((e=>{e.onclick=t=>{t.stopImmediatePropagation(),e.style.backgroundImage=`url('${e.getAttribute("data-pfp")}')`}}))}}))}function _(){return document.querySelector(".results-container").children.length}function S(){const e=_(),t=u.length,n=t-e;n>h?(document.querySelector(".view-more-section").classList.add("show-view-more"),document.querySelector(".view-more-button__count").innerText="[+25]"):document.querySelector(".view-more-section").classList.remove("show-view-more"),0!=n&&(n<=h||t<300)?(document.querySelector(".view-more-section").classList.add("show-view-all"),document.querySelector(".view-all-button__count").innerText=`[+${n}]`):document.querySelector(".view-more-section").classList.remove("show-view-all")}function E(e,t){if(0==e.length)return[1,0,0];t=t.toLowerCase();let n=0,o=[0,0],r=[0,0];for(let a=0;a<t.length;++a)if(t.charAt(a)==e.charAt(n)){r=[1,a];let s=a-1;for(;s>=0&&t.charAt(s)==e.charAt(n-(a-s));)++r[0],r[1]=s,--s;if(++n,(o[0]<r[0]||o[0]==r[0]&&o[1]>r[1])&&(o=r),n==e.length)break}return n==e.length?[n,...o]:[0,0,0]}function A(e,t){return text.includes(e)?[e.length,e.length,text.indexOf(e)]:[0,0,0]}function $(e,t){return text==e?[3,3,0]:[0,0,0]}!async function(){(async function(){"serviceWorker"in navigator&&"ready"in navigator.serviceWorker&&await navigator.serviceWorker.ready;const e=(await window.caches.keys())[0],n=await window.caches.open(e);let o=(await n.keys()).filter((e=>e.url.includes("/everyone/"))).map((e=>e.url.match(/\d+(?=\.json)/)[0]));const r={2015:29.61,2016:27.4,2017:11.6,2018:14.3,2019:15.2,2020:15.2,2021:13.7};0==o.length&&(o=["2019","2020","2021"]);const a=c(...o);if(o.length!=Object.keys(r).length){const e=Object.keys(r).filter((e=>!o.includes(e))),n=e.reduce(((e,t)=>e+r[t]),0);t(".filter-toggle[field='year']").forEach((t=>{e.includes(t.getAttribute("value"))&&t.remove()})),document.querySelector(".filter-component[value='year']").insertAdjacentHTML("afterend",`\n        <div id="data-download-popup" class="popup-component">\n            <div class="popup__text">\n                <header>More Data <span>(${n.toFixed(2)}Kb)</span></header>\n                Click to download data for ${e.map((e=>`<b>${e}</b>`)).join(", ")}\n            </div>\n            <div id="data-download-cta" class="popup__cta data-download-ready">\n                <button id="data-download-button" class="popup__button single-image-button">\n                    ${document.querySelector("#template-icon-download-svg").innerHTML}\n                </button>\n                <button id="data-loading-button" class="popup__button single-image-button">\n                    ${document.querySelector("#template-icon-loading-svg").innerHTML}\n                </button>\n                <button id="data-loaded-button" class="popup__button single-image-button">\n                    ${document.querySelector("#template-icon-loaded-svg").innerHTML}\n                </button>\n            </div>\n        </div>\n        `),function(e){document.querySelector("#data-download-button").onclick=async function(t){const n=e.map((e=>fetch(`./everyone/${e}.json`).then((e=>e.json()))));this.parentElement.classList.add("data-loading"),document.querySelector("#data-download-popup .popup__text").innerHTML="\n        <header>Downloading...</header>\n        This may take a while depending on your internet connection\n        ",await Promise.all(n),this.parentElement.classList.add("data-loaded"),document.querySelector("#data-download-popup .popup__text").innerHTML="\n        <header>Data Downloaded</header>\n        Click here to refresh the app and view the downloaded years\n        ",document.querySelector("#data-loaded-button").onclick=e=>{location.reload()}}}(e)}await a,document.querySelector(".page").style.display="flex",document.querySelector(".preloader").classList.add("loaded"),p()})(),async function(){await navigator.serviceWorker.ready,await fetch("./static/fonts/Inconsolata.woff2");let e="<style>";for(const t of[100,200,300,400,500,600,700,800,900])e+=`\n        @font-face {\n            font-family: 'Inconsolata';\n            font-style: normal;\n            font-display: swap;\n            font-weight: ${t};\n            src: url(./static/fonts/Inconsolata.woff2) format('woff2');\n        }\n        `.trim().replace(/\n\s*/g,"");e+="</style>",document.head.innerHTML+=e,document.documentElement.classList.add("font-loaded")}(),t("svg").forEach((e=>{e.setAttribute("version","1.1")})),function(){const e=navigator.userAgent;let t="";e.match(/samsungbrowser/i)?t="Tap on the download icon near the URL bar":e.match(/chrome|chromium|crios/i)||e.match(/firefox|fxios/i)?t="Go to options and press Install":e.match(/safari/i)?t="Press the share icon and 'Add to Home Screen'":e.match(/opr\//i)?t="IDK figure it out, who tf uses Opera":e.match(/edg/i)&&(t="Go to options and press Install");document.querySelector("#pwa-install-guide").innerText=t}(),document.querySelector("#close-settings-tab").onclick=e=>{n(100),document.querySelector(".settings-tab").classList.add("hidden")},document.querySelector("#open-settings-tab").onclick=e=>{n(100),document.querySelector(".settings-tab").classList.remove("hidden")},t(".filter-toggle").forEach((e=>{e.onclick=t=>{n(50),async function(e,t){if(!(e in s))return void(s[e]=[t]);const n=s[e].indexOf(t);-1==n?s[e].push(t):s[e].splice(n,1)}(e.getAttribute("field"),e.getAttribute("value")),e.classList.toggle("selected"),p()}})),t(".select-all-toggles").forEach((e=>{e.onclick=o=>{n(50);const r=e.getAttribute("value"),a=t(`[value="${r}"] .filter-toggle`);!async function(e,...t){e in s?0==s[e].length?s[e]=t:s[e]=[]:s[e]=t}(r,...a.map((e=>e.getAttribute("value")))),a.some((e=>e.classList.contains("selected")))?a.forEach((e=>e.classList.remove("selected"))):a.forEach((e=>e.classList.add("selected"))),p()}})),function(){document.querySelector(".view-more-button").onclick=e=>g(h);document.querySelector(".view-all-button").onclick=e=>g()}(),t(".sort-button").forEach((e=>{e.onclick=t=>{var o;e.classList.contains("selected")||(n(50),e.parentElement.querySelector(".selected").classList.remove("selected"),e.classList.add("selected"),o=e.getAttribute("value"),f=o,y(f))}})),document.querySelector("#search-bar-clear-icon").onclick=t=>{document.querySelector("input#search-bar").value="",document.querySelector(".search-or-clear-rel").classList.toggle("show-clear-button",0!=e.value.length),document.querySelector("input#search-bar").focus(),v()};let e=document.querySelector("input#search-bar");e.addEventListener("keyup",(()=>{document.querySelector(".search-or-clear-rel").classList.toggle("show-clear-button",0!=e.value.length),v()}),{passive:!0})}()}();
